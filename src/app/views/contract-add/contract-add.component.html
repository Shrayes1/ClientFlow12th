<c-row>
  <c-col xs>
    <c-card class="mb-4">
      <c-card-body>
        <div class="d-flex justify-content-between mb-3">
          <h5>Clients</h5>
          <button cButton style="background-color: #1E2029; color: white;" (click)="toggleUserForm()">Add New Client</button>
        </div>

        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th><c-icon name="cil-user"></c-icon></th>
              <th>Username</th>
              <th>Client Name</th>
              <th>Client ID</th>
              <th>Email</th>
              <th>Progress</th>
              <th>Initia Proposal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>
                <img [src]="user.profilePic" alt="Profile" class="profile-pic" *ngIf="user.profilePic" />
                <c-icon name="cil-user" *ngIf="!user.profilePic"></c-icon>
              </td>
              <td>{{ user.name }}</td>
              <td>{{ user.clientName }}</td>
              <td>{{ user.clientId }}</td>
              <td>{{ user.email }}</td>
              <td>
                <div class="progress-container">
                  <div class="progress-header">
                    <strong>{{ user.stage }}</strong> - <span>{{ user.progress }}%</span>
                  </div>
                  <c-progress [value]="user.progress" [color]="getProgressColor(user.progress)"></c-progress>
                </div>
              </td>
              <td>
                <button cButton color="info" *ngIf="user.contractUrl" (click)="viewContract(user)">
                  View Contract
                </button>
                <span *ngIf="!user.contractUrl" class="text-muted">Not uploaded yet</span>
              </td>
            </tr>
          </tbody>
        </table>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<!-- Add New User Form -->
<div *ngIf="showUserForm">
  <c-card class="mb-4">
    <c-card-body>
      <h5>Add New Client</h5>
      <form (submit)="addUser()">
        <c-row>
          <c-col md="6">
            <label>Username</label>
            <input class="form-control" [(ngModel)]="newUser.name" name="userName" required />
          </c-col>
          <c-col md="6">
            <label>Client Name</label>
            <input class="form-control" [(ngModel)]="newUser.clientName" name="clientName" required />
          </c-col>
        </c-row>
        <c-row class="mt-3">
          <c-col md="6">
            <label>Client ID</label>
            <input class="form-control" [(ngModel)]="newUser.clientId" name="clientId" required />
          </c-col>
          <c-col md="6">
            <label>Email</label>
            <input type="email" class="form-control" [(ngModel)]="newUser.email" name="email" required />
          </c-col>
        </c-row>
        <c-row class="mt-3">
          
          <c-col md="6">
            <label>Profile Picture</label>
            <input type="file" class="form-control" (change)="onProfilePicSelected($event)" />
          </c-col>
        </c-row>
        
        <!-- Contract Upload Section -->
        <c-row class="mt-3">
          <c-col md="12">
            <label style="margin-bottom: 10px;">Upload Contract</label>
            <div class="drop-zone" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onContractDropped($event)">
              <input type="file" hidden #contractInput (change)="onContractSelected($event)" />
              <button cButton style="background-color: #1E2029; color: white;" (click)="contractInput.click()">Browse</button>
            </div>
            <p *ngIf="newUser.contract" class="text-success mt-2">Uploaded: {{ newUser.contract?.name }}</p>
          </c-col>
        </c-row>

        <div class="mt-4">
          <button cButton style="background-color: #1E2029; color: white; outline: none; margin-right: 10px;" type="submit">
            Save Client
          </button>
          <button cButton style="background-color: #1E2029; color: white; outline: none;" type="button" (click)="toggleUserForm()">
            Cancel
          </button>
          
        </div>
      </form>
    </c-card-body>
  </c-card>
</div>
