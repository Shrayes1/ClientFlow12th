<div class="task-management-container">
  <h2>Task Management</h2>
  
  <div class="stepper-upload-container">
    <!-- Angular Material Horizontal Stepper -->
    <mat-horizontal-stepper [linear]="isLinear" #stepper>
      <mat-step [stepControl]="firstFormGroup" [editable]="stepCompleted[0] || stepper.selectedIndex === 0">
        <form [formGroup]="firstFormGroup">
          <ng-template matStepLabel>Client Addition</ng-template>
          <div>
            <button mat-button (click)="onStepComplete(0, stepper)">Verify</button>
            <button mat-button (click)="resetStep(0, stepper)">Reset</button>
          </div>
          <!-- Display completion time -->
          <span class="completion-time" *ngIf="completionTimes[0]">
            Completed: {{ completionTimes[0] }}
          </span>
        </form>
      </mat-step>
  
      <mat-step [stepControl]="secondFormGroup" [editable]="stepCompleted[1] || stepper.selectedIndex === 1">
        <form [formGroup]="secondFormGroup">
          <ng-template matStepLabel>Upload Draft Contract</ng-template>
          <p>Upload the draft contract before proceeding.</p>
          <label class="upload-box">
            <input type="file" (change)="onFileSelected($event, 1)">
            <span class="upload-icon">+</span>
            <p>Click to upload</p>
          </label>
          <div *ngIf="fileName && activeStepIndex === 1" class="file-info">
            <button class="file-type">{{ getFileType(fileName) }}</button>
            <button class="file-size">{{ fileSize }}</button>
            <div class="file-progress">
              <span>{{ fileName }}</span>
              <span *ngIf="isUploading">{{ uploadProgress }}% Uploading • {{ fileSize }}</span>
              <progress [value]="uploadProgress" max="100"></progress>
            </div>
          </div>
          <div class="button-group">
            <button mat-button class="action-button" (click)="onStepComplete(1, stepper)">Next</button>
            <button mat-button class="action-button" (click)="resetStep(1, stepper)">Reset</button>
            <button mat-button class="action-button cancel" (click)="cancelUpload()">Cancel</button>
            <button mat-button class="action-button save" [disabled]="uploadProgress < 100" (click)="saveAndContinue(1, stepper)">Save and Continue</button>
          </div>
          <!-- Display completion time -->
          <span class="completion-time" *ngIf="completionTimes[1]">
            Completed: {{ completionTimes[1] }}
          </span>
        </form>
      </mat-step>
  
      <mat-step [editable]="stepCompleted[2] || stepper.selectedIndex === 2">
        <ng-template matStepLabel>Upload Final Contract</ng-template>
        <p>Upload the final contract.</p>
        <label class="upload-box">
          <input type="file" (change)="onFileSelected($event, 2)">
          <span class="upload-icon">+</span>
          <p>Click to upload</p>
        </label>
        <div *ngIf="fileName && activeStepIndex === 2" class="file-info">
          <button class="file-type">{{ getFileType(fileName) }}</button>
          <button class="file-size">{{ fileSize }}</button>
          <div class="file-progress">
            <span>{{ fileName }}</span>
            <span *ngIf="isUploading">{{ uploadProgress }}% Uploading • {{ fileSize }}</span>
            <progress [value]="uploadProgress" max="100"></progress>
          </div>
        </div>
        <div class="button-group">
          <button mat-button class="action-button" (click)="onStepComplete(2, stepper)">Next</button>
          <button mat-button class="action-button" (click)="resetStep(2, stepper)">Reset</button>
          <button mat-button class="action-button cancel" (click)="cancelUpload()">Cancel</button>
          <button mat-button class="action-button save" [disabled]="uploadProgress < 100" (click)="saveAndContinue(2, stepper)">Save and Continue</button>
        </div>
        <!-- Display completion time -->
        <span class="completion-time" *ngIf="completionTimes[2]">
          Completed: {{ completionTimes[2] }}
        </span>
      </mat-step>
  
      <mat-step [editable]="stepCompleted[3] || stepper.selectedIndex === 3">
        <ng-template matStepLabel>Release Invoice</ng-template>
        <p>Invoice will be released upon final approval.</p>
        <div class="button-group">
          <button mat-button class="action-button" (click)="onStepComplete(3, stepper)">Next</button>
          <button mat-button class="action-button" (click)="resetStep(3, stepper)">Reset</button>
        </div>
        <!-- Display completion time -->
        <span class="completion-time" *ngIf="completionTimes[3]">
          Completed: {{ completionTimes[3] }}
        </span>
      </mat-step>
  
      <mat-step [editable]="stepCompleted[4] || stepper.selectedIndex === 4">
        <ng-template matStepLabel>Payment Received</ng-template>
        <p>Payment has been received. Process completed.</p>
        <div class="button-group">
          <button mat-button class="action-button" (click)="onStepComplete(4, stepper)">Complete</button>
          <button mat-button class="action-button" (click)="resetStep(4, stepper)">Reset</button>
        </div>
        <!-- Display completion time -->
        <span class="completion-time" *ngIf="completionTimes[4]">
          Completed: {{ completionTimes[4] }}
        </span>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
</div>